time="2019-05-28T03:27:10Z" level=info msg="CacheManager indexgroup : [serviceName nfType mcc:mnc dnn smfServingArea routingIndicators nsiList groupId ipDomainList iwkEpsInd]" stackinfo="/workspace/tmp/src/gerrit.ericsson.se/udm/nrfagent_discovery/pkg/cache/cachemanager.go:1574"
time="2019-05-28T03:27:10Z" level=info msg="Start nfType[AUSF,UDM] profile TtlMonitor work thread" stackinfo="/workspace/tmp/src/gerrit.ericsson.se/udm/nrfagent_discovery/pkg/cache/cachemonitor.go:40"
time="2019-05-28T03:27:10Z" level=info msg="Start nfType[AUSF,UDM] subscription TtlMonitor work thread" stackinfo="/workspace/tmp/src/gerrit.ericsson.se/udm/nrfagent_discovery/pkg/cache/cachesubscription.go:52"
time="2019-05-28T03:27:10Z" level=info msg="Start nfType[AUSF,UDM] profile TtlMonitor work thread" stackinfo="/workspace/tmp/src/gerrit.ericsson.se/udm/nrfagent_discovery/pkg/cache/cachemonitor.go:40"
time="2019-05-28T03:27:10Z" level=info msg="Start nfType[AUSF,UDM] subscription TtlMonitor work thread" stackinfo="/workspace/tmp/src/gerrit.ericsson.se/udm/nrfagent_discovery/pkg/cache/cachesubscription.go:52"
begin
=== RUN   TestSearchInCache
--- PASS: TestSearchInCache (0.07s)
	bench_test.go:171:  false
	bench_test.go:175: {"validityPeriod":86400,"nfInstances":[{"nfInstanceId":"12345678-9udm-def0-1000-310","nfType":"UDM","nfStatus":"REGISTERED","sNssais":[{"sst":0,"sd":"fff000"},{"sst":1,"sd":"fff111"}],"nsiList":["111111","222222","333333"],"fqdn":"seliius03696.seli.gic.ericsson.se","ipv4Addresses":["172.16.208.1","172.16.208.2","172.16.208.3","172.16.208.4","172.16.208.5","172.16.208.6","172.16.208.7","172.16.208.8"],"capacity":100,"udmInfo":{"supiRanges":[{"pattern":"^imsi-60000\\d{4}$"}],"gpsiRanges":[{"pattern":"^msisdn-42345678904\\d{4}$"}],"externalGroupIdentifiersRanges":[{"pattern":"^msisdn-52345678905\\d{4}$"}],"routingIndicators":["4321"]},"nfServices":[{"serviceInstanceId":"nudm-uecm-01","serviceName":"nudm-uecm","versions":[{"apiVersionInUri":"v1","apiFullVersion":"1.R15.1.1 ","expiry":"2020-07-06T02:54:32Z"}],"scheme":"https","nfServiceStatus":"REGISTERED","fqdn":"seliius03690.seli.gic.ericsson.se","ipEndPoints":[{"ipv6Address":"fe80:1234:0000:0000:0000:0000:0000:0000","transport":"TCP","port":30088},{"ipv6Address":"fe80:1234:0000:0000:0000:0000:0000:0000","transport":"TCP","port":30089},{"ipv6Address":"fe80:1234:0000:0000:0000:0000:0000:0002","transport":"TCP","port":30090},{"ipv6Address":"fe80:1234:0000:0000:0000:0000:0000:0000","transport":"TCP","port":30089},{"ipv6Address":"fe80:1234:0000:0000:0000:0000:0000:0000","transport":"TCP","port":30089}],"defaultNotificationSubscriptions":[{"notificationType":"N1_MESSAGES","callbackUri":"/nnrf-nfm/v1/nf-instances/udm-5g-01","n1MessageClass":"5GMM","n2InformationClass":"SM"}],"supportedFeatures":"A0A0"},{"serviceInstanceId":"nudm-uecm-02","serviceName":"nudm-uecm","versions":[{"apiVersionInUri":"v1","apiFullVersion":"1.R15.1.1 ","expiry":"2020-07-06T02:54:32Z"}],"scheme":"https","nfServiceStatus":"REGISTERED","fqdn":"seliius03690.seli.gic.ericsson.se","ipEndPoints":[{"ipv6Address":"fe80:1234:0000:0000:0000:0000:0000:0000","transport":"TCP","port":30088},{"ipv6Address":"fe80:1234:0000:0000:0000:0000:0000:0000","transport":"TCP","port":30089},{"ipv6Address":"fe80:1234:0000:0000:0000:0000:0000:0002","transport":"TCP","port":30090},{"ipv6Address":"fe80:1234:0000:0000:0000:0000:0000:0000","transport":"TCP","port":30089},{"ipv6Address":"fe80:1234:0000:0000:0000:0000:0000:0000","transport":"TCP","port":30089},{"ipv6Address":"fe80:1234:0000:0000:0000:0000:0000:0000","transport":"TCP","port":30089}],"supportedFeatures":"A0A0"}]}]} true
=== RUN   TestSpliteSeachResult
--- PASS: TestSpliteSeachResult (0.00s)
	cache_test.go:241: TestSpliteSeachResult validityPeriod value:86400
=== RUN   TestIndex
--- PASS: TestIndex (0.00s)
=== RUN   TestIndexNew
--- PASS: TestIndexNew (0.00s)
	cache_test.go:282: Create index for nfInstanceID[5g-ausf-01] profile success
	cache_test.go:288: Index ipDomainList[map[ericsson.se:Set{5g-ausf-01} ericsson.com:Set{5g-ausf-01}]]
	cache_test.go:289: Index dnaiList[map[]]
	cache_test.go:290: Index iwkEpsInd[map[false:Set{5g-ausf-01}]]
=== RUN   TestDeIndex
--- PASS: TestDeIndex (0.00s)
	cache_test.go:329: Current cacheIndex : map[nfType:map[UDM:Set{udm-5g-01}] mcc:mnc:map[460:000:Set{udm-5g-01} 560:001:Set{udm-5g-01}] smfServingArea:map[] nsiList:map[100:Set{udm-5g-01} 101:Set{udm-5g-01} 102:Set{udm-5g-01}] serviceName:map[nudm-auth-01:Set{udm-5g-01} nudm-ausf-01:Set{udm-5g-01}] routingIndicators:map[1111:Set{udm-5g-01}] groupId:map[udmtest:Set{udm-5g-01}] ipDomainList:map[] iwkEpsInd:map[] dnn:map[]]
=== RUN   TestCached
--- PASS: TestCached (0.00s)
	cache_test.go:368: nfProfile : {
		        "nfInstanceId": "udm-5g-01",
		        "nfType": "UDM",
		        "plmnList": [
				   {
		            "mcc": "460",
		            "mnc": "000"
		           },
				   {
		            "mcc": "560",
		            "mnc": "001"
		           }
				],
		        "sNssais": [{
		                "sst": 2,
		                "sd": "2"
		            },
		            {
		                "sst": 4,
		                "sd": "4"
		            }
		        ],
		        "nsiList": ["100","101","102"],
		        "fqdn": "seliius03695.seli.gic.ericsson.se",
		        "ipv4Addresses": ["172.16.208.1"],
		        "ipv6Addresses": ["FF01::1101"],
		        "ipv6Prefixes": ["FF01"],
		        "capacity": 100,
		        "load": 50,
		        "locality": "Shanghai",
		        "priority": 1,
		        "udrInfo": {
		            "supiRanges": [{
		                "start": "000001",
		                "end": "000010"
		            }]
		        },
		        "udmInfo": {
		            "groupId": "udmtest",
		            "supiRanges": [{
		                "start": "000001",
		                "end": "000010"
		            }],
		            "routingIndicators": ["1111"]
		        },
		        "ausfInfo": {
		            "supiRanges": [{
		                "start": "000001",
		                "end": "000010"
		            }],
		            "routingIndicators": ["2222"]
		        },
		        "amfInfo": {
		            "amfSetId": "amfSet-01",
		            "amfRegionId": "amfRegion-01",
		            "guamiList": [{
		                "plmn": {
		                    "mcc": "460",
		                    "mnc": "000"
		                },
		                "amfId": "amf-01"
		            }]
		        },
		        "smfInfo": {
		            "dnnList": [
		                "udm-dnn-011",
		                "udm-dnn-012"
		            ]
		        },
		        "upfInfo": {
		            "sNssaiUpfInfoList": [
		                {
		                    "sNssai": {
		                        "sst": 3,
		                        "sd": "sd3"
		                    },
		                    "dnnUpfInfoList": [
		                     {
		                        "dnn": "upf-dnn1"
		                     },
		                     {
		                        "dnn": "upf-dnn2"
		                     }
		                    ]
		                }
		            ]
		        },
		        "pcfInfo": {
		            "dnnlist":  ["pcf-dnn1","pcf-dnn2"]
		        },
		        "bsfInfo": {
		            "ipv4AdddressRanges": [{
		                "start": "172.16.208.0",
		                "end": "172.16.208.255"
		            }],
		            "ipv6PrefixRanges": [{
		                "start": "FF01",
		                "end": "FF0F"
		            }]
		        },
		        "nfServices": [{
		            "serviceInstanceId": "nudm-auth-01",
		            "serviceName": "nudm-auth-01",
		            "version": [{
		                "apiVersionInUri": "v1Url",
		                "apiFullVersion": "v1"
		            }],
		            "schema": "https://",
		            "fqdn": "seliius03690.seli.gic.ericsson.se",
		            "ipEndPoints": [{
		                "ipv4Address": "10.210.121.75",
		                "ipv6Address": "FF01::1101",
		                "ipv6Prefix": "FF01",
		                "transport": "TCP",
		                "port": 30080
		            }],
		            "apiPrefix": "nudm-uecm",
		            "defaultNotificationSubscriptions": [{
		                "notificationType": "N1_MESSAGES",
		                "callbackUri": "https://seliius03695.seli.gic.ericsson.se",
		                "n1MessageClass": "5GMM",
		                "n2InformationClass": "SM"
		            }],
		            "capacity": 0,
		            "load": 50,
		            "priority": 0,
		            "supportedFeatures": "A1"
		        },
		        {
		            "serviceInstanceId": "nudm-ausf-01",
		            "serviceName": "nudm-ausf-01",
		            "version": [{
		                "apiVersionInUri": "v1Url",
		                "apiFullVersion": "v1"
		            }],
		            "schema": "https://",
		            "fqdn": "seliius03690.seli.gic.ericsson.se",
		            "ipEndPoints": [{
		                "ipv4Address": "10.210.121.75",
		                "ipv6Address": "FF01::1101",
		                "ipv6Prefix": "FF01",
		                "transport": "TCP",
		                "port": 30080
		            }],
		            "apiPrefix": "nudm-uecm",
		            "defaultNotificationSubscriptions": [{
		                "notificationType": "N1_MESSAGES",
		                "callbackUri": "https://seliius03695.seli.gic.ericsson.se",
		                "n1MessageClass": "5GMM",
		                "n2InformationClass": "SM"
		            }],
		            "capacity": 0,
		            "load": 50,
		            "priority": 0,
		            "supportedFeatures": "A1"
		        }]
		    }
=== RUN   TestDeCached
--- PASS: TestDeCached (0.00s)
=== RUN   TestStatusCheck
--- PASS: TestStatusCheck (0.00s)
	cache_test.go:418: AUSF cache status : false
	cache_test.go:421: AUSF cache set false
	cache_test.go:427: AUSF cache status : true
=== RUN   TestFetchIDs
--- PASS: TestFetchIDs (0.00s)
	cache_test.go:453: cache ids : [udm-5g-01]
=== RUN   TestFlush
--- PASS: TestFlush (0.00s)
=== RUN   TestFetchProfileByID
--- PASS: TestFetchProfileByID (0.00s)
=== RUN   TestMeetIndexSearch
--- PASS: TestMeetIndexSearch (0.00s)
=== RUN   TestFetchProfileIds
time="2019-05-28T03:27:10Z" level=error msg="Get monitor timePoint for profile[udm-5g-01] fail, err:No such timer for udm-5g-01" stackinfo="/workspace/tmp/src/gerrit.ericsson.se/udm/nrfagent_discovery/pkg/cache/cachemonitor.go:151"
--- PASS: TestFetchProfileIds (0.00s)
=== RUN   TestFetchRoamingProfileIDs
time="2019-05-28T03:27:10Z" level=error msg="Get monitor timePoint for profile[udm-5g-02] fail, err:No such timer for udm-5g-02" stackinfo="/workspace/tmp/src/gerrit.ericsson.se/udm/nrfagent_discovery/pkg/cache/cachemonitor.go:151"
--- PASS: TestFetchRoamingProfileIDs (0.00s)
=== RUN   TestCachedWithTTL
--- FAIL: TestCachedWithTTL (0.00s)
	cachemanager_test.go:169: TestCachedWithTTL: CachedWithTTL cache fail
FAIL
end
ok  	gerrit.ericsson.se/udm/nrfagent_discovery/pkg/cache	0.083s
